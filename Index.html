<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FingerDiceClone - Sélecteur Aléatoire Multiple</title>
    
    <!--
    ╔═══════════════════════════════════════════════════════════════════════════╗
    ║                         FINGERDICE CLONE v2.0                             ║
    ║        MODIFIÉ POUR SÉLECTIONNER UN NOMBRE DÉFINI DE PROTAGONISTES         ║
    ╚═══════════════════════════════════════════════════════════════════════════╝
    
    📋 COMMENT UTILISER CETTE APPLICATION :
    
    1. Sur l'écran d'accueil, choisissez combien de personnes doivent être sélectionnées.
    2. Appuyez sur "Commencer".
    3. Tous les participants placent un doigt sur l'écran.
    4. Le décompte se lance automatiquement.
    5. L'application mettra en évidence le nombre de gagnants que vous avez défini.
    
    ✅ NOUVEAUTÉS :
       - Champ pour choisir le nombre de gagnants.
       - Sélection aléatoire de plusieurs protagonistes.
       - Affichage multiple des gagnants.
    
    🎨 TECHNOLOGIES : HTML5 + CSS3 + React 18 (via CDN)
    
    ═══════════════════════════════════════════════════════════════════════════
    -->
    
    <style>
        /* ═══════════════════════════════════════════════════════════════
           STYLES GLOBAUX - Reset et Configuration de Base
           ═══════════════════════════════════════════════════════════════ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            touch-action: none; /* Empêche le zoom et le scroll sur mobile */
        }
        
        #root {
            width: 100vw;
            height: 100vh;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           ÉCRAN D'ACCUEIL - Page de démarrage
           ═══════════════════════════════════════════════════════════════ */
        .home-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .home-screen h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .home-screen p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* Styles pour le champ de sélection du nombre de gagnants */
        .winner-input-container {
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .winner-input-container label {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .winner-input-container input {
            width: 80px;
            padding: 10px;
            font-size: 1.5rem;
            text-align: center;
            border-radius: 8px;
            border: 2px solid white;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: bold;
        }
        
        .btn-primary {
            background: white;
            color: #667eea;
            border: none;
            padding: 1rem 3rem;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           ÉCRAN DE JEU - Zone de détection tactile
           ═══════════════════════════════════════════════════════════════ */
        .game-screen {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .instructions {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            z-index: 10;
            text-align: center;
            padding: 0 20px;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           AFFICHAGE DU DÉCOMPTE - Grand chiffre au centre
           ═══════════════════════════════════════════════════════════════ */
        .countdown-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 15rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 30px rgba(0,0,0,0.5);
            z-index: 50;
            animation: countdownPulse 1s ease-in-out infinite;
        }
        
        @keyframes countdownPulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.8;
            }
        }
        
        .touch-area {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           INDICATEURS DE DOIGTS - Cercles colorés pour chaque toucher
           ═══════════════════════════════════════════════════════════════ */
        .finger {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            pointer-events: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            background: #FF6B6B; /* Rouge par défaut */
        }
        
        /* Doigt perdant - reste rouge */
        .finger.loser {
            background: #FF6B6B !important;
            opacity: 0.6;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           ANIMATION DU GAGNANT - Effet pulsation et couleur verte
           ═══════════════════════════════════════════════════════════════ */
        .finger.winner {
            animation: winnerPulse 1s ease-in-out infinite;
            width: 180px;
            height: 180px;
            font-size: 4rem;
            z-index: 100;
            box-shadow: 0 0 40px rgba(76, 175, 80, 0.8);
            background: #4CAF50 !important; /* Vert pour le gagnant */
        }
        
        @keyframes winnerPulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
        }
        
        /* ═══════════════════════════════════════════════════════════════
           BOUTON DE SÉLECTION - Bouton pour lancer le tirage au sort
           ═══════════════════════════════════════════════════════════════ */
        .select-btn {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #f5576c;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 20;
            transition: all 0.3s ease;
        }
        
        .select-btn:hover {
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.4);
        }
        
        /* ═══════════════════════════════════════════════════════════════
           RESPONSIVE - Adaptation mobile
           ═══════════════════════════════════════════════════════════════ */
        @media (max-width: 768px) {
            .home-screen h1 {
                font-size: 2.5rem;
            }
            
            .instructions {
                font-size: 1.3rem;
            }
            
            .countdown-display {
                font-size: 10rem;
            }
            
            .finger {
                width: 100px;
                height: 100px;
                font-size: 2rem;
            }
            
            .finger.winner {
                width: 150px;
                height: 150px;
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Conteneur principal pour React -->
    <div id="root"></div>
    
    <!-- Chargement de React et ReactDOM depuis CDN -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <script>
        /* ═══════════════════════════════════════════════════════════════
           COMPOSANT PRINCIPAL REACT - FingerDiceClone
           ═══════════════════════════════════════════════════════════════ */
        const { useState, useEffect, useRef } = React;
        
        function FingerDiceClone() {
            // États de l'application
            const [screen, setScreen] = useState('home'); // 'home' | 'game' | 'countdown' | 'result'
            const [touches, setTouches] = useState([]); // Liste des doigts actifs
            const [frozenTouches, setFrozenTouches] = useState([]); // Doigts figés pour le résultat
            const [winners, setWinners] = useState([]); // Doigts gagnants (maintenant un tableau)
            const [numWinners, setNumWinners] = useState(1); // Nombre de gagnants à sélectionner
            const [countdown, setCountdown] = useState(5); // Décompte (5, 4, 3, 2, 1)
            const touchAreaRef = useRef(null); // Référence à la zone tactile
            const countdownTimerRef = useRef(null); // Timer du décompte
            
            /* ═══════════════════════════════════════════════════════════
               GESTIONNAIRE D'ÉVÉNEMENTS TACTILES
               Gère l'ajout, le déplacement et le retrait des doigts
               ═══════════════════════════════════════════════════════════ */
            useEffect(() => {
                if (screen !== 'game' || !touchAreaRef.current) return;
                
                const area = touchAreaRef.current;
                
                const updateTouches = (touchList) => {
                    const newTouches = Array.from(touchList).map((touch, idx) => ({
                        id: touch.identifier,
                        x: touch.clientX,
                        y: touch.clientY,
                        number: idx + 1
                    }));
                    setTouches(newTouches);
                    
                    // Démarrer le décompte dès le premier doigt
                    if (newTouches.length > 0 && !countdownTimerRef.current && screen === 'game') {
                        // On passe les touches actuelles à la fonction de décompte
                        startCountdown(newTouches);
                    }
                };
                
                const handleTouchStart = (e) => {
                    e.preventDefault();
                    updateTouches(e.touches);
                };
                
                const handleTouchMove = (e) => {
                    e.preventDefault();
                    updateTouches(e.touches);
                };
                
                const handleTouchEnd = (e) => {
                    e.preventDefault();
                    updateTouches(e.touches);
                };
                
                // FALLBACK POUR DESKTOP : Simulation avec clics de souris
                const handleMouseDown = (e) => {
                    const newTouch = {
                        id: Date.now(),
                        x: e.clientX,
                        y: e.clientY,
                        number: touches.length + 1
                    };
                    const newTouches = [...touches, newTouch];
                    setTouches(newTouches);
                    
                    if (newTouches.length === 1 && !countdownTimerRef.current) {
                        startCountdown(newTouches);
                    }
                };
                
                area.addEventListener('touchstart', handleTouchStart);
                area.addEventListener('touchmove', handleTouchMove);
                area.addEventListener('touchend', handleTouchEnd);
                area.addEventListener('mousedown', handleMouseDown);
                
                return () => {
                    area.removeEventListener('touchstart', handleTouchStart);
                    area.removeEventListener('touchmove', handleTouchMove);
                    area.removeEventListener('touchend', handleTouchEnd);
                    area.removeEventListener('mousedown', handleMouseDown);
                };
            }, [screen, touches]); // Dépend de `touches` pour le fallback desktop
            
            /* ═══════════════════════════════════════════════════════════
               DÉCOMPTE 5-4-3-2-1 (dès le premier doigt posé)
               Compte à rebours avant la sélection
               ═══════════════════════════════════════════════════════════ */
            const startCountdown = (initialTouches) => {
                // S'assurer qu'on ne démarre pas plusieurs décomptes
                if (countdownTimerRef.current) return;

                setScreen('countdown');
                let lastKnownTouches = initialTouches;
                
                let count = 5;
                setCountdown(count);

                countdownTimerRef.current = setInterval(() => {
                    // Mettre à jour la liste des doigts à chaque seconde
                    setTouches(currentTouches => {
                        lastKnownTouches = currentTouches;
                        return currentTouches;
                    });
                    
                    count--;
                    if (count > 0) {
                        setCountdown(count);
                    } else {
                        // Fin du décompte
                        clearInterval(countdownTimerRef.current);
                        countdownTimerRef.current = null;
                        
                        if (lastKnownTouches.length > 0) {
                            // Figer les positions
                            setFrozenTouches(lastKnownTouches);
                            
                            // Sélectionner les gagnants
                            selectWinners(lastKnownTouches);
                            
                            // Passer à l'écran de résultat
                            setScreen('result');
                        } else {
                            // S'il n'y a plus de doigts, on recommence
                            restart();
                        }
                    }
                }, 1000);
            };
            
            /* ═══════════════════════════════════════════════════════════
               FONCTION DE SÉLECTION ALÉATOIRE (MODIFIÉE)
               Choisit un ou plusieurs gagnants parmi les doigts figés
               ═══════════════════════════════════════════════════════════ */
            const selectWinners = (finalTouches) => {
                if (finalTouches.length === 0) return;
                
                // On s'assure de ne pas vouloir sélectionner plus de gagnants qu'il n'y a de participants
                const numberOfWinnersToSelect = Math.min(numWinners, finalTouches.length);
                
                // On mélange le tableau des participants (algorithme de Fisher-Yates)
                const shuffled = [...finalTouches];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                
                // On prend les N premiers éléments du tableau mélangé
                const selectedWinners = shuffled.slice(0, numberOfWinnersToSelect);
                
                setWinners(selectedWinners);
            };
            
            /* ═══════════════════════════════════════════════════════════
               FONCTION DE RÉINITIALISATION
               Retourne à l'écran d'accueil
               ═══════════════════════════════════════════════════════════ */
            const restart = () => {
                if (countdownTimerRef.current) {
                    clearInterval(countdownTimerRef.current);
                    countdownTimerRef.current = null;
                }
                
                setTouches([]);
                setFrozenTouches([]);
                setWinners([]);
                setCountdown(5);
                setScreen('home');
            };
            
            // Nettoyage des timers au démontage
            useEffect(() => {
                return () => {
                    if (countdownTimerRef.current) clearInterval(countdownTimerRef.current);
                };
            }, []);
            
            /* ═══════════════════════════════════════════════════════════
               RENDU CONDITIONNEL - Affichage des différents écrans
               ═══════════════════════════════════════════════════════════ */
            
            // ÉCRAN D'ACCUEIL
            if (screen === 'home') {
                return React.createElement('div', { className: 'home-screen' },
                    React.createElement('h1', null, '👆 FingerDice'),
                    React.createElement('p', null, 'Qui sera désigné ? Placez vos doigts pour le découvrir !'),
                    
                    // NOUVEAU : Champ pour choisir le nombre de gagnants
                    React.createElement('div', { className: 'winner-input-container' },
                        React.createElement('label', { htmlFor: 'num-winners' }, 'Nombre de personnes à sélectionner :'),
                        React.createElement('input', {
                            type: 'number',
                            id: 'num-winners',
                            value: numWinners,
                            min: 1,
                            onChange: (e) => setNumWinners(Math.max(1, parseInt(e.target.value, 10) || 1))
                        })
                    ),
                    
                    React.createElement('button', { 
                        className: 'btn-primary',
                        onClick: () => setScreen('game')
                    }, 'Commencer')
                );
            }
            
            // ÉCRAN DE JEU & DÉCOMPTE (fusionnés pour une transition fluide)
            if (screen === 'game' || screen === 'countdown') {
                const currentTouches = screen === 'countdown' ? frozenTouches : touches;

                return React.createElement('div', { className: 'game-screen' },
                    // Afficher le décompte au centre si en cours
                    screen === 'countdown' && React.createElement('div', { className: 'countdown-display' }, countdown),
                    
                    React.createElement('div', { className: 'instructions' },
                        touches.length === 0 
                            ? 'Posez vos doigts sur l\'écran !'
                            : 'Gardez vos doigts immobiles !'
                    ),
                    React.createElement('div', { 
                        className: 'touch-area',
                        ref: touchAreaRef
                    },
                        // Affichage des cercles pour chaque doigt
                        touches.map((touch) =>
                            React.createElement('div', {
                                key: touch.id,
                                className: 'finger',
                                style: {
                                    left: `${touch.x}px`,
                                    top: `${touch.y}px`
                                }
                            }, touch.number)
                        )
                    )
                );
            }
            
            // ÉCRAN DE RÉSULTAT
            if (screen === 'result') {
                return React.createElement('div', { className: 'game-screen result-screen' },
                    React.createElement('div', { className: 'instructions' }, `🎉 ${winners.length} Protagoniste${winners.length > 1 ? 's' : ''} Sélectionné${winners.length > 1 ? 's' : ''} ! 🎉`),
                    React.createElement('div', { className: 'touch-area' },
                        // Affichage des doigts figés avec gagnants/perdants
                        frozenTouches.map((touch) => {
                            // Vérifier si le doigt actuel fait partie du tableau des gagnants
                            const isWinner = winners.some(winner => winner.id === touch.id);
                            
                            return React.createElement('div', {
                                key: `result-${touch.id}`,
                                className: `finger ${isWinner ? 'winner' : 'loser'}`,
                                style: {
                                    left: `${touch.x}px`,
                                    top: `${touch.y}px`,
                                    position: 'absolute'
                                }
                            }, touch.number);
                        })
                    ),
                    React.createElement('button', {
                        className: 'select-btn',
                        onClick: restart
                    }, '🔄 Recommencer')
                );
            }
            
            return null;
        }
        
        /* ═══════════════════════════════════════════════════════════════
           MONTAGE DE L'APPLICATION REACT
           ═══════════════════════════════════════════════════════════════ */
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(FingerDiceClone));
    </script>
</body>
</html>
